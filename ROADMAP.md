# План доработок проекта AI-intensive

Документ объединяет стратегию развития всех подсистем репозитория и служит "точкой входа" для планирования.

## Общие (root проекта)
- [ ] CI/CD: GitHub Actions для сборки `issue-monitor` (fat-jar), линтинга и прогонов тестов
- [ ] Единый шаблон `.env.example`/`config.properties.sample` и инструкция по секретам
- [ ] Версионирование релизов (tags, changelog) и релиз артефактов (jar, docker image)
- [ ] Улучшить документацию: обзор архитектуры (MCP ↔ apps), схемы обмена, частые ошибки

## mcp_server/
- [ ] Dockerfile + docker-compose (node:lts-alpine, healthcheck)
- [ ] Логи в JSON-формате, корректные коды ошибок JSON-RPC, расширенная диагностика
- [ ] Rate limiting и простая аутентификация (например, `X-API-Key` через ревёрс-прокси)
- [ ] Интеграционные тесты инструментов (`get_repo`, `search_repos`, `create_issue`) с моками GitHub API
- [ ] Безопасность: валидация входных параметров, защита от слишком частых запросов

- [x] Инструмент выполнения Java-кода в контейнере (`docker_exec_java`)
  - Вход: `filename`, `entrypoint` (main class), `classpath`, доп. флаги
  - Передача кода: volume-монтаж; рабочая директория и политика очистки
  - Выход: stdout/stderr, код возврата, длительность; структурированный JSON
  - Таймаут выполнения, лимиты ресурсов контейнера
- [ ] Улучшить `docker_start_java`: диагностика демона/порта, ретраи, понятные сообщения об ошибках
- [ ] Безопасность Docker-инструментов: запрет опасных флагов в `extra_args`, whitelisting параметров

## issue-monitor/
- [ ] Добавить Docker/systemd unit под среду Linux (для issue-monitor)
  - Dockerfile (eclipse-temurin:17-jre-alpine, non-root user, tini)
  - docker-compose с зависимостью от `mcp_server`
  - systemd unit c переменной `CONFIG_FILE`, авто‑рестартом и журналированием
- [ ] Health‑check (встроенный HTTP `/health` или периодический лог‑пульс)
- [ ] Ретраи и backoff при сбоях MCP/сети, авто‑reconnect WebSocket
- [ ] Структурированные логи (ключевые поля: repo, count, mcpUrl, error)
- [ ] Метрики (опционально Prometheus: количество уведомлений, ошибки, длительность)
- [ ] Конфиг‑reload без рестарта (перечитывание файла по сигналу/таймеру)
- [ ] Тесты: unit (формирование сообщения/парсинг ответа), интеграционные (локальный тестовый MCP)

## sample_app/
- [ ] Оптимизировать страницу настроек
  - Упростить UX: единый блок MCP (URL, проверка подключения), явная индикация статуса
  - Валидация ввода (URL, пустые поля), подсказки и описание сценариев
  - Кнопка быстрого теста (create_issue) — единый поток для локального GitHub и внешнего MCP
  - Сохранение/применение настроек без перезапуска, аккуратные Snackbar/Dialogs об ошибках
  - Адаптивность и читабельность (мобильный/десктоп), i18n строк
- [ ] Рефакторинг зависимостей настроек (Provider/ChangeNotifier): мемоизация, разбиение на виджеты
- [ ] Покрытие UI‑тестами критических сценариев (проверка MCP и создание issue)

- [x] CodeOps: выполнение кода через Docker (первичная интеграция)
  - [x] Кнопка/подтверждение запуска для JSON‑генерации/вставленного кода
  - [x] Отображение stdout/stderr и кодов возврата; базовый таймаут
  - [x] Применена JSON‑схема запуска (filename, entrypoint)
  - [x] Автоопределение entrypoint/filename из Java‑кода (public class, package → FQCN и путь файла)
  - [ ] Улучшить UX отмены/повтора: индикатор прогресса, кнопка отмены; улучшенная обработка таймаута (follow‑up)
  - [ ] Надёжность/ошибки (CodeOps)
    - [ ] Обработка ошибок Docker/сети с дружелюбными сообщениями
    - [ ] Предварительная проверка доступности MCP/Docker перед запуском
    - [ ] Ретраи/повтор вызова MCP при временных сбоях
    - [ ] Улучшенные сообщения в UI (коды ошибок, подсказки, next steps)
    - [ ] Структурированные логи и trace id для корреляции
  - [ ] Расширенные параметры (classpath, args) из UI (опционально)
  - [ ] UI‑конфигурация Docker параметров: `image`, `container_name`, `limits`, `timeout`
  - [ ] E2E‑тест потока CodeOps: генерация → подтверждение → запуск в Docker → отображение результата (smoke‑тест)

## Деплой и эксплуатация
- [ ] Плейбуки для VPS: подготовка окружения (Node, JDK 17, systemd, Docker), развертывание
- [ ] Скрипты обновления (zero‑downtime перезапуск сервисов)
- [ ] Мониторинг и алерты (ошибки MCP, отсутствие уведомлений, рост open issues)

## Идеи на будущее
- [ ] Фильтрация/агрегация: уведомления по меткам (labels), по исполнителям, по SLA
- [ ] Расширение MCP: инструмент `list_issues` c фильтрами; `create_comment` для авто‑комментариев
- [ ] Мульти‑канальные уведомления: Slack/Webhook (в дополнение к Telegram)
