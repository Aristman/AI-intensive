# ROADMAP: Workspace Orchestrator Agent

Этот документ описывает план работ по созданию и интеграции агента-оркестратора рабочей области (Workspace Orchestrator Agent) в архитектуру проекта и экран Workspace.

## Цели
- Общение с пользователем в правой панели Workspace.
- Определение намерений пользователя и построение плана работ (на следующих этапах).
- Делегирование атомарных задач другим агентам (на следующих этапах).
- Вывод промежуточных и итоговых результатов в чат.
- Хранение и восстановление контекста беседы.

## Этап 1 (MVP): Только общение через LLM
- [ ] Создать каркас агента `WorkspaceOrchestratorAgent`, совместимый с архитектурой агентов
  - [ ] Реализовать класс в `sample_app/lib/agents/workspace_orchestrator_agent.dart`
  - [ ] Наследование: использовать `IAgent` + `IStatefulAgent` для истории, `IToolingAgent` — на будущее (минимальная реализация)
  - [ ] Подключить LLM через общий `resolveLlmUseCase(AppSettings)`
  - [ ] Определить и применить `conversationKey`: `workspace_orchestrator`
  - [ ] Реализовать хранение и восстановление истории (SharedPreferences, как в ReasoningAgent)
  - [ ] Минимальные события/логи для диагностики
- [ ] Интегрировать агента в UI экрана Workspace
  - [ ] Файл: `sample_app/lib/screens/workspace_screen.dart`
  - [ ] Подключить агента к уже существующей правой панели чата
  - [ ] Отображение сообщений пользователя и LLM, индикатор загрузки
  - [ ] Кнопка очистки истории (по аналогии с ChatScreen)
- [ ] Регистрация/роутинг
  - [ ] Проверить `sample_app/lib/screens/screens.dart` и тест `sample_app/test/screens/screens_mapping_test.dart`
  - [ ] При необходимости — добавить/обновить маппинг
- [ ] Тесты
  - [ ] Юнит‑тест агента: базовый диалог `ask()`, сохранение/восстановление истории
  - [ ] Виджет‑тест WorkspaceScreen: отображение сообщений в правой панели, очистка истории
- [ ] Документация
  - [ ] Обновить `sample_app/README.md` (раздел Workspace)
  - [ ] Обновить/создать раздел в `docs/` (краткое описание ролей и взаимодействия)

## Этап 2: Интенты, Планирование, Декомпозиция
- [ ] Добавить определение намерений пользователя (intent classification)
- [ ] Ввести структуру плана (список шагов/атомарных действий)
- [ ] Показ плана пользователю с подтверждением/коррекцией
- [ ] Хранение плана в контексте агента, синхронизация с правой панелью

## Этап 3: Интеграция с агентами-«элементалами» через MCP/локальные вызовы
- [ ] Подключить делегирование шагов плана агентам (CodeOpsAgent, ReasoningAgent и т.п.)
- [ ] Стриминг промежуточных результатов в чат
- [ ] Агрегация и финальная сводка результатов
- [ ] Расширенные тесты (сквозные сценарии, e2e)

## Технические заметки
- Использовать унифицированный интерфейс агентов: `sample_app/lib/agents/agent_interface.dart`
- Общий резолвер LLM: `sample_app/lib/domain/llm_resolver.dart`
- Персист истории — через `SharedPreferences` (как в ReasoningAgent/ChatScreen), с собственным `conversationKey`
- Следовать существующим практикам логирования и ключам для тестируемости виджетов (Keys)

## Критерии готовности Этапа 1
- [ ] Есть класс `WorkspaceOrchestratorAgent` в кодовой базе, совместимый с интерфейсом агентов
- [ ] В `WorkspaceScreen` отображается чат с рабочим состоянием (отправка запроса → ответ LLM)
- [ ] История диалога сохраняется и восстановляется между сессиями
- [ ] Присутствуют базовые тесты и они проходят локально (`flutter test`)
- [ ] Документация обновлена (README, ROADMAP помечен выполненными пунктами)
