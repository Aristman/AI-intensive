# ROADMAP: Workspace Orchestrator Agent

Этот документ описывает план работ по созданию и интеграции агента-оркестратора рабочей области (Workspace Orchestrator Agent) в архитектуру проекта и экран Workspace.

## Цели
- Общение с пользователем в правой панели Workspace.
- Определение намерений пользователя и построение плана работ (на следующих этапах).
- Делегирование атомарных задач другим агентам (на следующих этапах).
- Вывод промежуточных и итоговых результатов в чат.
- Хранение и восстановление контекста беседы.

## Этап 1 (MVP): Только общение через LLM
- [x] Создать каркас агента `WorkspaceOrchestratorAgent`, совместимый с архитектурой агентов
  - [x] Реализовать класс в `sample_app/lib/agents/workspace_orchestrator_agent.dart`
  - [x] Наследование: использовать `IAgent` + `IStatefulAgent` для истории, `IToolingAgent` — на будущее (минимальная реализация)
  - [x] Подключить LLM через общий `resolveLlmUseCase(AppSettings)`
  - [x] Определить и применить `conversationKey`: `workspace_orchestrator`
  - [x] Реализовать хранение и восстановление истории (SharedPreferences, как в ReasoningAgent)
  - [x] Минимальные события/логи для диагностики
- [x] Интегрировать агента в UI экрана Workspace
  - [x] Файл: `sample_app/lib/screens/workspace_screen.dart`
  - [x] Подключить агента к уже существующей правой панели чата
  - [x] Отображение сообщений пользователя и LLM, индикатор загрузки
  - [x] Кнопка очистки истории (по аналогии с ChatScreen)
- [x] Регистрация/роутинг
  - [x] Проверить `sample_app/lib/screens/screens.dart` и тест `sample_app/test/screens/screens_mapping_test.dart`
  - [x] При необходимости — добавить/обновить маппинг
- [ ] Тесты
  - [ ] Юнит‑тест агента: базовый диалог `ask()`, сохранение/восстановление истории
  - [ ] Виджет‑тест WorkspaceScreen: отображение сообщений в правой панели, очистка истории
- [x] Документация
  - [x] Обновить `sample_app/README.md` (раздел Workspace)
  - [x] Обновить/создать раздел в `docs/` (краткое описание ролей и взаимодействия)

## Этап 2: Интенты, Планирование, Декомпозиция
- [x] Добавить определение намерений пользователя (intent classification)
- [x] Ввести структуру плана (список шагов/атомарных действий)
- [x] Хранение плана в контексте агента
- [x] Вывод плана по запросу пользователя в чат (без отдельного UI‑блока); поддержаны команды добавления шага и отметки выполненных
- [x] Базовые файловые операции по запросу пользователя (прочитать файл, список каталога, запись файла)
- [x] LLM debug‑логи (время, провайдер, длины system/history/ответа) в `AgentResponse.meta` и dev.log

## Этап 3: Интеграция с агентами-«элементалами» через MCP/локальные вызовы
- [ ] Подключить делегирование шагов плана агентам (CodeOpsAgent, ReasoningAgent и т.п.)
- [ ] Стриминг промежуточных результатов в чат
- [ ] Агрегация и финальная сводка результатов
- [ ] Расширенные тесты (сквозные сценарии, e2e)

## Технические заметки
- Использовать унифицированный интерфейс агентов: `sample_app/lib/agents/agent_interface.dart`
- Общий резолвер LLM: `sample_app/lib/domain/llm_resolver.dart`
- Персист истории — через `SharedPreferences` (как в ReasoningAgent/ChatScreen), с собственным `conversationKey`
- Следовать существующим практикам логирования и ключам для тестируемости виджетов (Keys)
 - Файловые сущности: `agents/workspace/workspace_file_entities.dart` (FilePreview, FileOpResult, DirListing)

## Критерии готовности Этапа 1
- [x] Есть класс `WorkspaceOrchestratorAgent` в кодовой базе, совместимый с интерфейсом агентов
- [x] В `WorkspaceScreen` отображается чат с рабочим состоянием (отправка запроса → ответ LLM)
- [x] История диалога сохраняется и восстановляется между сессиями
- [ ] Присутствуют базовые тесты и они проходят локально (`flutter test`) — перенесено на конец разработки
- [ ] Документация обновлена (README, ROADMAP помечен выполненными пунктами)
