# ROADMAP: Рабочее окно (Файлы — Редактор — Правая панель)

Контекст:
- Платформы: Desktop (Windows) первично. Web/Android/iOS — поэтапно (после Desktop).
- Доступ к ФС: чтение/редактирование, сохранение на диск (Desktop). Без создания/удаления в MVP.
- Стартовая директория: D:/projects/ai_intensive/AI-intensive/
- Правая панель: без интеграции существующих агентов. Каркас под будущий пайплайн (UI + заглушки).
- Пакеты: разрешены (flutter_code_editor/code_text_field + highlight, flutter_treeview/ExpansionTile, file_icons и т.п.).

## Этап 1 — Базовая архитектура и навигация
- [x] Создать новый экран `WorkspaceScreen` и маршрут в `sample_app`.
- [x] Добавить точку входа в навигации (кнопка/меню) для открытия `WorkspaceScreen`.
- [x] Ввести состояние экрана (ChangeNotifier/Provider): список вкладок, активный файл, dirty‑флаги, кэш содержимого.
 - [ ] Конфигурация: стартовая директория фиксирована (переменная/константа для Desktop). 

Критерии приёмки:
- [x] Экран открывается из существующего приложения без ошибок.
- [x] Пустое состояние отображается корректно (без выбранного файла).

## Этап 2 — Левая панель: проводник (Desktop)
- [x] Построение дерева директорий от `D:/projects/ai_intensive/AI-intensive/` (ленивая подгрузка).
- [x] Иконки для папок/файлов (file_icons/devicons по расширению).
- [x] Раскрытие/сворачивание папок (сохранение состояния раскрытия на время сессии).
- [x] Клик по файлу — открывает файл во вкладке (или фокус на уже открытой).

Критерии приёмки:
- [ ] Большие директории раскрываются без заметных лагов.
- [ ] Клик по файлу в дереве гарантированно показывает его содержимое в центре.

## Этап 3 — Центральная панель: вкладки и редактор
- [x] Шапка с вкладками: заголовок — имя файла + индикатор несохранённых изменений (●).
 - [ ] Действия по вкладке: переключить, закрыть (с подтверждением при несохранённых изменениях).
 - [ ] Редактор с подсветкой синтаксиса (выбор грамматики по расширению).
 - [x] Сохранение (Ctrl+S и кнопка): запись на диск (Desktop), обновление dirty‑флага.
 - [x] Перезагрузка содержимого с диска (кнопка/меню), предупреждение при потере несохранённых.
 - [x] Базовые горячие клавиши: Ctrl+S (сохранить), Ctrl+W (закрыть вкладку), Ctrl+Tab (переключение вкладок).

Критерии приёмки:
- [ ] Подсветка синтаксиса корректна для популярных расширений (dart, js, ts, json, md, yaml, kt, java и т.д.).
- [ ] Изменения сохраняются на диск и видны при внешнем открытии файла.

## Этап 4 — Правая панель: каркас под будущий пайплайн
- [ ] Верх: список (лента) сообщений/событий пайплайна (пока заглушка: пустой список).
- [ ] Низ: поле ввода и кнопка «Отправить» — пока отключены или имитируют локальную запись (без агентов).
- [ ] Структурная заготовка для будущего переключения «режимов/агентов» (без реализации логики).

Критерии приёмки:
- [ ] UI устойчив, элементы корректно адаптируются по ширине/высоте.
- [ ] Отсутствие сетевых вызовов/зависимости от MCP/LLM.

## Этап 5 — Сохранение/восстановление состояния
- [ ] Запоминать последние открытые вкладки и активную вкладку (SharedPreferences/локально).
- [ ] Восстановление состояния при повторном открытии `WorkspaceScreen`.

Критерии приёмки:
- [ ] После перезапуска приложения список вкладок и активная вкладка восстанавливаются.

## Этап 6 — Тесты
- [ ] Виджет‑тест: проводник — раскрытие/клик → открытие файла в центре.
- [ ] Виджет‑тест: вкладки — открыть несколько, переключение, закрытие с подтверждением.
- [ ] Юнит‑тест состояния: dirty‑флаги, сохранение/перезагрузка.
- [ ] Виджет‑тест правой панели: отрисовка каркаса без агентской логики.

Критерии приёмки:
- [ ] Все новые тесты проходят локально и в CI (если применимо).

## Этап 7 — Документация
- [ ] Обновить `sample_app/README.md`: раздел «Рабочее окно (Файлы‑Редактор‑Правая панель)», ограничения (Desktop‑только в MVP).
- [ ] Зафиксировать хоткеи, подсветку, стартовую директорию.
- [ ] Обновить данный ROADMAP с отметками выполненных пунктов.

---

Пост‑MVP (поэтапно)
- [ ] Web/Android/iOS: виртуальная ФС, импорт/экспорт, drag‑and‑drop (Web), сохранение в LocalStorage/FS Access API.
- [ ] Наблюдение за внешними изменениями файлов (Directory.watch) и авто‑перезагрузка с уведомлением.
- [ ] Контекстные действия в проводнике (создать/переименовать/удалить/перетаскивание) — под флагом.
- [ ] Расширенные настройки редактора (шрифты, темы, отображение невидимых символов, автоперенос, мини‑карта).
- [ ] Интеграция будущего пайплайна/агентов в правую панель.
