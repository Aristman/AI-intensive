# Roadmap для MCP-сервера Telegram (JavaScript/ESM)

## Обзор
Создание с нуля MCP-сервера для работы с Telegram API на современном JavaScript (ESM). Сервер реализует 6 ключевых функций: разрешение чатов, чтение истории, отправка сообщений, пересылка, маркировка прочитанных и получение количества непрочитанных сообщений.

## Шаги реализации

### 1. Подготовка проекта
- [x] Создать Roadmap.md с планом
- [x] Создать package.json с зависимостями:
  - @modelcontextprotocol/sdk
  - telegram (gramjs для MTProto)
- [x] Установить зависимости через npm install

### 2. Конфигурация и утилиты
- [x] Реализовать src/config.js:
  - Объект конфигурации (name, version)
  - Получение параметров из process.env (apiId, apiHash, phoneNumber)
  - Обработка отсутствия параметров с логированием ошибок
  - JSDoc комментарии
- [x] Реализовать src/utils.js:
  - setupTelegramClient: асинхронная инициализация MTProto клиента с 2FA
  - getInputEntity: получение InputPeer по идентификатору чата
  - logError: функция логирования ошибок в stderr

### 3. Обработчики MCP
- [x] Реализовать src/handlers/resources.js:
  - resources.list: возвращает пустой массив или плейсхолдеры
  - resources.read: заглушка с ошибкой "Resource not found"
  - Асинхронные функции с try/catch
- [x] Реализовать src/handlers/tools.js:
  - tools.list: массив из 6 инструментов с name и inputSchema (JSON Schema)
  - tools.call: маршрутизация вызовов по toolName
  - Реализация 6 функций Telegram:
    - resolve_chat: разрешение чата по ID/username
    - get_chat_history: чтение истории с пагинацией (лимит, смещение)
    - send_message: отправка текстового сообщения
    - forward_message: пересылка сообщения
    - mark_read: маркировка сообщений как прочитанных
    - get_unread_count: получение количества непрочитанных
  - Обработка ошибок с try/catch и возвратом {error: message}
  - Использование функций из utils.js

### 4. Точка входа
- [x] Реализовать src/index.js:
  - Импорт модулей (@modelcontextprotocol/sdk, config, handlers)
  - Создание экземпляра Server
  - Регистрация обработчиков ресурсов и инструментов
  - Инициализация с StdioTransport
  - Graceful shutdown с обработкой SIGINT и отключением клиента

### 5. Тестирование и доработки
- [ ] Тестирование запуска сервера
- [ ] Проверка аутентификации Telegram клиента
- [ ] Тестирование каждого инструмента (с заглушками если нужно)
- [ ] Добавление TODO-комментариев для сложных частей (пагинация и т.д.)
- [ ] Логирование ошибок и отладка

### 6. Документация и финализация
- [x] Обновление Roadmap.md с отмеченными выполненными шагами
- [x] Добавление README.md с инструкциями по запуску и конфигурации
- [ ] Финальное тестирование всех компонентов

## Зависимости
- Node.js 18+ (для ESM)
- Переменные окружения: TELEGRAM_API_ID, TELEGRAM_API_HASH, TELEGRAM_PHONE_NUMBER

## Примечания
- Все асинхронные операции с сетью/файлами используют async/await
- Логирование ошибок только в stderr через console.error
- Заглушки для нереализованных частей с TODO-комментариями
- Строгое следование архитектуре из ТЗ
