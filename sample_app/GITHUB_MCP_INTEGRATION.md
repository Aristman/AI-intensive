# Интеграция GitHub MCP в приложение

## Обзор

В приложение добавлена интеграция с GitHub MCP (Model Context Protocol), которая позволяет обогащать запросы к LLM актуальной информацией из GitHub репозиториев.

## Функциональность

### Что делает GitHub MCP:

1. **Автоматическое распознавание GitHub-запросов** - система анализирует сообщения пользователя и определяет, относятся ли они к GitHub репозиториям.

2. **Получение информации о репозитории** - при упоминании репозитория в формате `github.com/owner/repo` или `owner/repo`, система автоматически получает:
   - Основную информацию (название, описание, язык, звезды, форки)
   - Последние коммиты
   - Статистику активности

3. **Поиск репозиториев** - если запрос содержит ключевые слова для поиска (найти, поиск, и т.д.), система выполняет поиск по GitHub.

4. **Анализ репозитория** - при запросах на анализ, система предоставляет структурированный анализ репозитория.

### Как это работает:

1. Пользователь отправляет сообщение в чат
2. Система анализирует текст на предмет упоминаний GitHub
3. Если GitHub MCP включен в настройках и есть валидный токен, система:
   - Получает актуальную информацию из GitHub API
   - Обогащает системный промпт полученными данными
   - Отправляет расширенный запрос в LLM
4. LLM использует предоставленную информацию для более точного ответа

## Настройка

### 1. Включение GitHub MCP:

1. Откройте приложение
2. Перейдите в настройки (иконка ⚙️ в правом верхнем углу)
3. В разделе "Выбор MCP" активируйте переключатель "Github MCP"

### 2. Настройка токена:

GitHub токен теперь хранится в .env файле для улучшения безопасности.

1. Откройте файл `sample_app/assets/.env`
2. Добавьте или обновите строку:
   ```
   GITHUB_MCP_TOKEN=ваш_токен_здесь
   ```
3. Система автоматически проверит валидность токена из .env файла
4. При успешной проверке в настройках появится зеленая отметка "✅ Токен найден и действителен"

### Как получить GitHub токен:

1. Перейдите в настройки GitHub: https://github.com/settings/tokens
2. Нажмите "Generate new token" → "Generate new token (classic)"
3. Задайте имя токена (например, "Sample App MCP")
4. Выберите срок действия (recommended: 90 дней или no expiration)
5. Установите следующие разрешения (scopes):
   - `public_repo` - для доступа к публичным репозиториям
   - `repo:status` - для доступа к статусу репозиториев
   - `read:user` - для чтения информации о пользователе
6. Нажмите "Generate token"
7. Скопируйте сгенерированный токен (начинается с `ghp_`)
8. Добавьте токен в файл `.env` как показано выше

## Примеры использования

### Пример 1: Информация о репозитории
```
Пользователь: Расскажи о репозитории flutter/flutter
```
Система автоматически получит информацию о репозитории Flutter и предоставит подробный ответ со статистикой.

### Пример 2: Анализ репозитория
```
Пользователь: Проанализируй репозиторий microsoft/vscode
```
Система предоставит структурированный анализ репозитория VS Code.

### Пример 3: Поиск репозиториев
```
Пользователь: Найди репозитории для машинного обучения на Python
```
Система выполнит поиск и вернет топ-5 релевантных репозиториев.

## Индикация использования MCP

Когда GitHub MCP активно используется для обогащения контекста, в заголовке чата появляется зеленый индикатор "MCP".

## Обработка ошибок

- Если токен не найден в .env файле или недействителен, система покажет красный крест ❌ и сообщение "Токен не найден или недействителен"
- Если GitHub API недоступен, запрос будет выполнен без обогащения
- Система логирует ошибки для отладки, но продолжает работу

### Устранение неполадок

### Проблема: "Токен не найден или недействителен"

**Решение:**
1. Проверьте, что файл `sample_app/assets/.env` существует
2. Убедитесь, что в файле есть строка `GITHUB_MCP_TOKEN=ваш_токен`
3. Проверьте, что токен скопирован правильно (должен начинаться с `ghp_`)
4. Убедитесь, что токен не истек
5. Проверьте, что у токена есть необходимые права (scopes)
6. Перезапустите приложение после изменений в `.env` файле

### Проблема: GitHub MCP не работает

**Решение:**
1. Убедитесь, что опция "Github MCP" включена в настройках
2. Проверьте наличие и валидность токена в `.env` файле через экран настроек
3. Проверьте интернет-соединение
4. Проверьте, что запрос содержит упоминание GitHub репозитория

### Проблема: Индикатор MCP не появляется

**Решение:**
1. Убедитесь, что запрос действительно связан с GitHub
2. Проверьте, что репозиторий существует и публичный
3. Проверьте настройки и наличие токена в `.env` файле
4. Посмотрите логи приложения на предмет ошибок API

## Безопасность

- GitHub токен хранится в `.env` файле, который не включается в систему контроля версий
- Токен передается только в GitHub API для аутентификации
- Рекомендуется регулярно обновлять токен и использовать ограниченные права
- Никогда не добавляйте `.env` файл в Git репозиторий

## Ограничения

- GitHub MCP работает только с запросами, явно связанными с GitHub
- Система ограничивает количество результатов поиска (топ-5)
- При ошибках API GitHub gracefully degraded до обычного режима работы