# –†–æ–∞–¥–º–∞–ø: –ú–Ω–æ–≥–æ—ç—Ç–∞–ø–Ω—ã–π –∞–≥–µ–Ω—Ç (–ê–Ω–∞–ª–∏–∑ ‚Üí –ü–ª–∞–Ω ‚Üí –ò—Å–ø–æ–ª–Ω–µ–Ω–∏–µ/–ü—Ä–æ–≤–µ—Ä–∫–∞ ‚Üí –°–∏–Ω—Ç–µ–∑ ‚Üí –†–µ—Ñ–ª–µ–∫—Å–∏—è)

–ü—Ä–µ–¥–ø–æ—á—Ç–µ–Ω–∏—è (–∑–∞—Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–æ):
- –î–æ–ª–≥–æ—Å—Ä–æ—á–Ω–∞—è –ø–∞–º—è—Ç—å: SharedPreferences
- –ü–æ–∏—Å–∫: —á–µ—Ä–µ–∑ MCP —Å–µ—Ä–≤–µ—Ä `mcp_servers/yandex_search_mcp_server`

## –ß–µ–∫–ª–∏—Å—Ç —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏

- [ ] –£—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏–π –∏ UX: —ç–∫—Ä–∞–Ω, –≤—ã–±–æ—Ä LLM (Yandex/DeepSeek), –ø–æ–ª–∏—Ç–∏–∫–∞ –ø–∞–º—è—Ç–∏
- [ ] –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –∞–≥–µ–Ω—Ç–∞
  - [ ] –°–ø–µ—Ü–∏—Ñ–∏–∫–∞—Ü–∏—è –∫–ª–∞—Å—Å–æ–≤: `MultiStepReasoningAgent`, DTO —Å–æ–±—ã—Ç–∏–π –∏ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤
  - [ ] –ö–æ–Ω—Ç—Ä–∞–∫—Ç—ã —Å—Ç—Ä–æ–≥–æ–≥–æ JSON –º–µ–∂–¥—É —ç—Ç–∞–ø–∞–º–∏ (—Å—Ö–µ–º—ã –∏ –≤–∞–ª–∏–¥–∞—Ç–æ—Ä—ã)
  - [ ] –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Ü–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω–æ–≥–æ `resolveLlmUseCase(AppSettings)`
- [ ] –≠–∫—Ä–∞–Ω UI `sample_app/lib/screens/reasoning_agent_screen.dart`
  - [ ] –ü–æ–ª–µ –≤–≤–æ–¥–∞, –∫–Ω–æ–ø–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏, –∫–Ω–æ–ø–∫–∞ –æ—Ç–º–µ–Ω—ã
  - [ ] –ü–æ—Ç–æ–∫–æ–≤–æ–µ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ —ç—Ç–∞–ø–æ–≤: ü§î –ê–Ω–∞–ª–∏–∑, üîç –ò—Å–ø–æ–ª–Ω–µ–Ω–∏–µ, ‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞, üìù –°–∏–Ω—Ç–µ–∑, ‚ôªÔ∏è –†–µ—Ñ–ª–µ–∫—Å–∏—è
  - [ ] –ò–Ω–¥–∏–∫–∞—Ç–æ—Ä –∑–∞–≥—Ä—É–∑–∫–∏, –Ω–µ–±–ª–æ–∫–∏—Ä—É—é—â–∏–π UI
  - [ ] –†–µ–Ω–¥–µ—Ä Markdown —Ñ–∏–Ω–∞–ª—å–Ω–æ–≥–æ –æ—Ç–≤–µ—Ç–∞
- [ ] –ù–∞–≤–∏–≥–∞—Ü–∏—è
  - [ ] –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è —ç–∫—Ä–∞–Ω–∞ –≤ `sample_app/lib/screens/screens.dart`
  - [ ] –ü—É–Ω–∫—Ç –≤ –º–µ–Ω—é/Settings
- [ ] –ú–æ–¥—É–ª—å 1 ‚Äî –ü—Ä–∏—ë–º –∏ –ø—Ä–µ–¥–æ–±—Ä–∞–±–æ—Ç–∫–∞
  - [ ] –ö—Ä–∞—Ç–∫–æ—Å—Ä–æ—á–Ω–∞—è –∏—Å—Ç–æ—Ä–∏—è (–ø–æ—Å–ª–µ–¥–Ω–∏–µ N —Å–æ–æ–±—â–µ–Ω–∏–π)
  - [ ] –°–∂–∞—Ç–∏–µ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞ —á–µ—Ä–µ–∑ LLM (reuse –ø–æ–¥—Ö–æ–¥ –∏–∑ `ReasoningAgent`)
  - [ ] –î–æ–ª–≥–æ—Å—Ä–æ—á–Ω–∞—è –ø–∞–º—è—Ç—å –≤ SharedPreferences —Å –∫–ª—é—á–æ–º –¥–∏–∞–ª–æ–≥–∞
- [ ] –ú–æ–¥—É–ª—å 2 ‚Äî –ê–Ω–∞–ª–∏–∑ –∏ –ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ
  - [ ] –ü—Ä–æ–º–ø—Ç ‚Üí —Å—Ç—Ä–æ–≥–∏–π JSON: `{ intent, type, needs, plan: Step[], tools: Tool[] }`
  - [ ] –°–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å YandexGPT/DeepSeek (—Å—Ç—Ä–æ–≥–∏–π JSON + fallback –∏–∑ fenced-–±–ª–æ–∫–æ–≤)
  - [ ] –ü–∞—Ä—Å–µ—Ä –∏ –≤–∞–ª–∏–¥–∞—Ü–∏—è —Å—Ö–µ–º—ã
- [ ] –ú–æ–¥—É–ª—å 3 ‚Äî –î–∏—Å–ø–µ—Ç—á–µ—Ä –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–≤
  - [ ] `search_web(query)` —á–µ—Ä–µ–∑ MCP `yandex_search_mcp_server`
  - [ ] `calculate(expression)` (–ª–æ–∫–∞–ª—å–Ω—ã–π Dart –≤—ã—á–∏—Å–ª–∏—Ç–µ–ª—å)
  - [ ] `get_current_date()`
  - [ ] –¢–æ—á–∫–∏ —Ä–∞—Å—à–∏—Ä–µ–Ω–∏—è: `read_file(path)`, `call_api(endpoint)` (–∑–∞–≥–ª—É—à–∫–∏)
- [ ] –ú–æ–¥—É–ª—å 4 ‚Äî –ü—Ä–æ–≤–µ—Ä–∫–∞ –∏ –≤–µ—Ä–∏—Ñ–∏–∫–∞—Ü–∏—è
  - [ ] –ü—Ä–æ–º–ø—Ç –ø—Ä–æ–≤–µ—Ä–∫–∏ —à–∞–≥–∞ ‚Üí —Å—Ç—Ä–æ–≥–∏–π JSON: `{ isRelevant: bool, confidence: number, reason: string }`
  - [ ] –ü–æ–ª–∏—Ç–∏–∫–∞ —Ä–µ—Ç—Ä–∞–µ–≤ –∏ —É—Ç–æ—á–Ω–µ–Ω–∏–π –∑–∞–ø—Ä–æ—Å–∞ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–∞ –ø—Ä–∏ `isRelevant:false`
  - [ ] –õ–∏–º–∏—Ç—ã –ø–æ–ø—ã—Ç–æ–∫ –∏ —Ç–∞–π–º–∞—É—Ç—ã
- [ ] –ú–æ–¥—É–ª—å 5 ‚Äî –°–∏–Ω—Ç–µ–∑ –æ—Ç–≤–µ—Ç–∞
  - [ ] –§–∏–Ω–∞–ª—å–Ω—ã–π –ø—Ä–æ–º–ø—Ç: –æ–±—ä–µ–¥–∏–Ω–µ–Ω–∏–µ –ø—Ä–æ–≤–µ—Ä–µ–Ω–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö + –ø–ª–∞–Ω + –∏—Å—Ö–æ–¥–Ω—ã–π –∑–∞–ø—Ä–æ—Å
  - [ ] Markdown-–æ—Ç–≤–µ—Ç (—Å—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–π, —Å –∏—Å—Ç–æ—á–Ω–∏–∫–∞–º–∏/—Å–Ω–æ—Å–∫–∞–º–∏ –≥–¥–µ –≤–æ–∑–º–æ–∂–Ω–æ)
- [ ] –ú–æ–¥—É–ª—å 6 ‚Äî –†–µ—Ñ–ª–µ–∫—Å–∏—è
  - [ ] –ö—Ä–∞—Ç–∫–∏–π –ø—Ä–æ–º–ø—Ç —Å–∞–º–æ–æ—Ü–µ–Ω–∫–∏ (–ø–æ–ª–Ω–æ—Ç–∞, —É–ª—É—á—à–µ–Ω–∏—è)
  - [ ] –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –º–µ—Ç—Ä–∏–∫/–≤—ã–≤–æ–¥ –∫—Ä–∞—Ç–∫–æ–≥–æ —Ä–µ–∑—é–º–µ
- [ ] –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –∏ —É—Å—Ç–æ–π—á–∏–≤–æ—Å—Ç—å
  - [ ] –ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–µ –ø–∞–π–ø–ª–∞–π–Ω—ã/Isolate –¥–ª—è –¥–ª–∏—Ç–µ–ª—å–Ω—ã—Ö —à–∞–≥–æ–≤
  - [ ] –¢–∞–π–º–∞—É—Ç—ã —ç—Ç–∞–ø–æ–≤, –æ–±—Ä–∞–±–æ—Ç–∫–∞ –æ—Ç–º–µ–Ω—ã
  - [ ] –ë—ç–∫–æ—Ñ—Ñ/–ø–æ–≤—Ç–æ—Ä—ã –Ω–∞ —Å–µ—Ç–µ–≤—ã—Ö –æ—à–∏–±–∫–∞—Ö MCP/LLM
- [ ] –õ–æ–≥–∏ –∏ —Ç—Ä–∞—Å—Å–∏—Ä–æ–≤–∫–∞
  - [ ] –°–æ–±—ã—Ç–∏—è —ç—Ç–∞–ø–æ–≤ —Å –¥–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å—é, —Å—Ç–∞—Ç—É—Å—ã –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–≤, –æ—à–∏–±–∫–∏
  - [ ] –ö–æ—Ä—Ä–µ–ª—è—Ü–∏—è –∑–∞–ø—Ä–æ—Å–æ–≤ (traceId) –ø–æ –∞–Ω–∞–ª–æ–≥–∏–∏ —Å —Å–µ—Ä–≤–µ—Ä–Ω—ã–º–∏ –ø—Ä–∞–∫—Ç–∏–∫–∞–º–∏
- [ ] –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ
  - [ ] –Æ–Ω–∏—Ç: –ø—Ä–æ–º–ø—Ç—ã, –ø–∞—Ä—Å–µ—Ä—ã JSON, –ø–æ–ª–∏—Ç–∏–∫–∞ —Ä–µ—Ç—Ä–∞–µ–≤/—Ç–∞–π–º–∞—É—Ç–æ–≤
  - [ ] –ú–æ–∫–∏: LLM –∏ MCP-–∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã (–≤–∫–ª—é—á–∞—è –Ω–µ–≥–∞—Ç–∏–≤–Ω—ã–µ –≤–µ—Ç–∫–∏)
  - [ ] –í–∏–¥–∂–µ—Ç-—Ç–µ—Å—Ç—ã: –ø–æ—Ç–æ–∫ —ç—Ç–∞–ø–æ–≤, –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä—ã, –æ—Ç–º–µ–Ω–∞, Markdown-—Ä–µ–Ω–¥–µ—Ä
  - [ ] –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ —Å—Ü–µ–Ω–∞—Ä–∏–∏: —Ñ–∞–∫—Ç—á–µ–∫–∏–Ω–≥ —Å —Ä–µ—Ç—Ä–∞—è–º–∏, —Å–∏–Ω—Ç–µ–∑, —Ä–µ—Ñ–ª–µ–∫—Å–∏—è
- [ ] –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è
  - [ ] `docs/multi_step_reasoning_agent.md`: –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞, –∫–æ–Ω—Ç—Ä–∞–∫—Ç—ã, –¥–∏–∞–≥—Ä–∞–º–º—ã –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç–µ–π
  - [ ] –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ `sample_app/README.md` (–æ–ø–∏—Å–∞–Ω–∏–µ —ç–∫—Ä–∞–Ω–∞, –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ MCP URL)

## –ö–æ–Ω—Ç—Ä–∞–∫—Ç—ã JSON (—á–µ—Ä–Ω–æ–≤–∏–∫)

- –ê–Ω–∞–ª–∏–∑/–ü–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ:
```json
{
  "intent": "...",
  "type": "factual|analytical|creative|...",
  "needs": ["..."],
  "plan": [
    {"id": 1, "title": "...", "description": "...", "tool": "search_web|calculate|get_current_date|...", "input": {"query": "..."}}
  ],
  "tools": ["search_web", "calculate", "get_current_date"]
}
```

- –ü—Ä–æ–≤–µ—Ä–∫–∞ —à–∞–≥–∞:
```json
{ "isRelevant": true, "confidence": 0.82, "reason": "..." }
```

- –°–∏–Ω—Ç–µ–∑ (–≤–Ω—É—Ç—Ä–µ–Ω–Ω–∏–π –æ–±–º–µ–Ω):
```json
{
  "originalQuery": "...",
  "validatedSteps": [
    {"id": 1, "tool": "search_web", "input": {"query": "..."}, "result": {...}, "validation": {"isRelevant": true, "confidence": 0.9, "reason": "..."}}
  ],
  "finalPlan": [ ... ]
}
```

## –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏

- LLM: —á–µ—Ä–µ–∑ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π `resolveLlmUseCase(AppSettings)`
- MCP: –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ `mcp_servers/yandex_search_mcp_server` (WebSocket JSON-RPC), –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ `tools/list` –∏ `tools/call` –¥–ª—è `search_web`
- –ü–∞–º—è—Ç—å: SharedPreferences (–∫—Ä–∞—Ç–∫–æ—Å—Ä–æ—á–Ω–∞—è –∏—Å—Ç–æ—Ä–∏—è + —Å–æ—Ö—Ä–∞–Ω—ë–Ω–Ω—ã–µ —Å–≤–æ–¥–∫–∏/—Ä–µ—Ñ–ª–µ–∫—Å–∏—è)

## –ü—Ä–∏–º–µ—á–∞–Ω–∏—è

- –°—Ç—Ä–æ–≥–∏–π JSON –æ–±—è–∑–∞—Ç–µ–ª–µ–Ω. –î–ª—è –º–æ–¥–µ–ª–µ–π, —Å–∫–ª–æ–Ω–Ω—ã—Ö –∫ —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏—é, –≤–∫–ª—é—á–∞—Ç—å fallback‚Äë–ø–∞—Ä—Å–∏–Ω–≥ –∏–∑ fenced-–±–ª–æ–∫–æ–≤.
- –°–ø–∏—Å–æ–∫ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–≤ —Ä–∞—Å—à–∏—Ä—è–µ–º –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏—è –ø—Ä–æ—Ç–æ–∫–æ–ª–∞ –∞–≥–µ–Ω—Ç–∞.
